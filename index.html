<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Beast Global Efootball League</title>
<style>
  body { font-family: Arial, sans-serif; background: #f9f9f9; padding: 10px; margin: 0; }
  h1 { text-align: center; color: #007bff; }
  .tab { display: flex; justify-content: center; margin-bottom: 20px; }
  .tab button { flex: 1; padding: 15px; font-size: 16px; cursor: pointer; border: none; outline: none; transition: 0.3s; }
  .tab button.active { background-color: #007bff; color: white; font-weight: bold; }
  #adminSection, #memberSection { padding: 10px; }
  #adminForm input { padding: 12px; margin: 5px 0; width: calc(50% - 12px); font-size: 16px; }
  #adminForm button { padding: 15px 20px; font-size: 16px; background-color: #28a745; color: white; border: none; cursor: pointer; margin-top: 10px; width: 100%; }
  #fixturesTable { width: 100%; border-collapse: collapse; margin-top: 20px; }
  #fixturesTable th, #fixturesTable td { border: 1px solid #ccc; padding: 12px; text-align: center; }
  #fixturesTable th { background-color: #007bff; color: white; }
  @media(max-width:600px) {
    #adminForm input { width: 100%; }
  }
</style>
</head>
<body>

<h1>Beast Global Efootball League</h1>

<div class="tab">
  <button id="adminTab" class="active">Admin</button>
  <button id="memberTab">Member</button>
</div>

<div id="adminSection">
  <form id="adminForm">
    <input type="text" id="teamA" placeholder="Enter Team A" required>
    <input type="text" id="teamB" placeholder="Enter Team B" required>
    <input type="text" id="score" placeholder="Enter Score (e.g., 0-0)" required>
    <button type="submit">Add Fixture</button>
  </form>
</div>

<div id="memberSection" style="display:none;">
  <p style="text-align:center;">Current Fixtures:</p>
</div>

<table id="fixturesTable">
  <thead>
    <tr>
      <th>Match</th>
      <th>Score</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<script>
// ================= Configuration =================
const repo = "MosesMugo/murage"; // your GitHub repo path
const token = "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
"; // your API key / PAT
const githubFilePath = "fixtures.json";

// ================= Tabs =================
const adminTab = document.getElementById("adminTab");
const memberTab = document.getElementById("memberTab");
const adminSection = document.getElementById("adminSection");
const memberSection = document.getElementById("memberSection");

adminTab.onclick = () => {
  adminSection.style.display = "block";
  memberSection.style.display = "none";
  adminTab.classList.add("active");
  memberTab.classList.remove("active");
};
memberTab.onclick = () => {
  adminSection.style.display = "none";
  memberSection.style.display = "block";
  memberTab.classList.add("active");
  adminTab.classList.remove("active");
};

// ================= Fixtures =================
let fixtures = [];

// Load from LocalStorage first
if(localStorage.getItem("fixtures")) {
  fixtures = JSON.parse(localStorage.getItem("fixtures"));
  renderFixtures();
}

// ================= Admin Form =================
const form = document.getElementById("adminForm");
form.addEventListener("submit", async (e) => {
  e.preventDefault();
  const teamA = document.getElementById("teamA").value.trim();
  const teamB = document.getElementById("teamB").value.trim();
  const score = document.getElementById("score").value.trim();
  if(teamA && teamB && score) {
    const fixture = { match: `${teamA} vs ${teamB}`, score };
    fixtures.push(fixture);
    localStorage.setItem("fixtures", JSON.stringify(fixtures));
    renderFixtures();
    await updateGitHub(fixtures);
    form.reset();
  }
});

// ================= Render Table =================
function renderFixtures() {
  const tbody = document.querySelector("#fixturesTable tbody");
  tbody.innerHTML = "";
  fixtures.forEach(f => {
    const tr = document.createElement("tr");
    tr.innerHTML = `<td>${f.match}</td><td>${f.score}</td>`;
    tbody.appendChild(tr);
  });
}

// ================= GitHub API =================
async function updateGitHub(data) {
  try {
    const getRes = await fetch(`https://api.github.com/repos/${repo}/contents/${githubFilePath}`, {
      headers: { "Authorization": `token ${token}` }
    });
    const fileData = await getRes.json();
    const sha = fileData.sha || null;

    const putRes = await fetch(`https://api.github.com/repos/${repo}/contents/${githubFilePath}`, {
      method: "PUT",
      headers: {
        "Authorization": `token ${token}`,
        "Content-Type": "application/json"
      },
      body: JSON.stringify({
        message: "Update fixtures",
        content: btoa(JSON.stringify(data, null, 2)),
        sha: sha
      })
    });
    const result = await putRes.json();
    console.log("GitHub updated:", result);
  } catch (err) {
    console.error("GitHub update failed:", err);
  }
}

// ================= Auto-sync GitHub =================
async function fetchGitHub() {
  try {
    const res = await fetch(`https://api.github.com/repos/${repo}/contents/${githubFilePath}`, {
      headers: { "Authorization": `token ${token}` }
    });
    const fileData = await res.json();
    if(fileData.content) {
      const decoded = JSON.parse(atob(fileData.content));
      fixtures = decoded;
      localStorage.setItem("fixtures", JSON.stringify(fixtures));
      renderFixtures();
    }
  } catch(err) {
    console.warn("Could not fetch from GitHub, using local data.");
  }
}

// Fetch every 10 seconds
setInterval(fetchGitHub, 10000);
</script>

</body>
</html>
